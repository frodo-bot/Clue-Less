<!-- cluelesstemplates/index.html -->
{% extends 'base.html' %}

{% block title %}Clue-Less{% endblock %}

{% block content %}
{% if user.is_authenticated %}
  <h1>Hi {{ user.username }}!</h1>
  <p><a href="{% url 'logout' %}">logout</a></p>

  <h4>Character:</h4>
  <select id="character">
    <option value="Miss Scarlet">Miss Scarlet</option>
    <option value="Professor Plum">Professor Plum</option>
    <option value="Mr. Green">Mr. Green</option>
  </select>

  <br/>

  <h4>Weapon:</h4>
  <select id="weapon">
    <option value="rope">rope</option>
    <option value="lead pipe">lead pipe</option>
    <option value="knife">knife</option>
  </select>

  <br/>

  <h4>Room:</h4>
  <select id="room">
    <option value="study">study</option>
    <option value="library">library</option>
    <option value="billiard room">billiard room</option>
  </select>

  <br/>
  <br/>

  <button id="suggest">Make Suggestion</button>
  <button id="clear">Clear</button>
  <p id="game-state"></p>

  <script type="text/javascript">
    var isActive = true;

    $(document).ready( function() {
      pollServer();

      $("#suggest").click(function() {
        var weapon = $('#weapon :selected').text();
        var room = $('#room :selected').text();
        var character = $('#character :selected').text();
        $.post("{% url 'suggestion' %}", {csrfmiddlewaretoken : "{{ csrf_token }}", name: "{{ user.username }}",
          weapon: weapon, room: room, character: character})
          .done(function(data) {
            updateBoard(data.messages);
          })
      });

      $("#clear").click(function() {
        $.post("{% url 'clear_state' %}", {csrfmiddlewaretoken : "{{ csrf_token }}"})
          .done(function(data) {
            updateBoard(data.messages);
          })
      });
    });

    function pollServer() {
      $.get("{% url 'game' %}", function(data) {
        updateBoard(data.messages);
      });
      setTimeout(pollServer, 2000);
    }

    function updateBoard(items) {
      var gameString = "";
      items.forEach(function(item) {
        gameString += item += "<br/>";
      });
      $("#game-state").html(gameString);
    }
  </script>
{% else %}
  <p>You are not logged in</p>
  <a href="{% url 'login' %}">Log in</a>
  <p>Don't have an account?</p>
  <a href="{% url 'signup' %}">Sign up</a>
{% endif %}
{% endblock %}
