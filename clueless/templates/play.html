<!-- cluelesstemplates/play.html -->
{% extends 'base.html' %}

{% block title %}Clue-Less{% endblock %}

{% block content %}
{% if user.is_authenticated %}

{#  Clue - Less  #}
<img class="center" src="../static/logo.png" alt="Card image" style="height: 100px; width: 350px; align-self: center;">
<hr style="align:center;width:30%;" />

{#  Main container div  #}
<div id="container">

    {# Left Column #}
    <div class="left left-all">
        <div class="options">
            <!--div class="options-inner"-->

            <p class="title" style="font-size:150%;">Welcome, {{ user.username }}!</p>
            <br />

            <div style="width:400px;">
                <div style="width:350px;">
                    <p class="title">Player List</p>
                    <ul id="player-list"></ul>
                </div>
                <div style="float:right; margin-top:-130px;">
                    <p class="title">Current Player</p>
                    <p id="current-player" style="margin-left: 20px; margin-top:-5px; font-family:optima;"></p>
                </div>
            </div>

            <div>
                <p class="title">Your Cards</p>
                <ul id="cards" class="list-group" style="margin-left:20px; font-family:optima;"></ul>
            </div>

            <p class="title" style="margin-top:30px;">Notifications</p>
            <p id="notification" style="max-width: 450px; margin-left:10px;"></p>

        </div>
    </div>



    {# Main board #}
    <div class="board">
        <div>
        <table id="board">
            <tbody>
            {# Row 1 #}
            <tr>
                <td class="empty"></td>
                <td class="empty"></td>
                <td class="empty"></td>
                <td class="empty"></td>
                <td id="scarlet-starting" class="starting"></td>
                <td class="empty"></td>
                <td class="empty"></td>
            </tr>
            {# Row 2 #}
            <tr>
                <td class="empty"></td>
                <td id="study" class="room">
                    <p id="study-players"></p>
                </td>
                <td class="hallway">
                    <a class="hallwaytext">Study - Hall</a>
                    <p id="study-hall-players"></p>
                </td>
                <td id="hall" class="room">
                    <p id="hall-players"></p>
                </td>
                <td class="hallway">
                    <a class="hallwaytext">Hall - Lounge</a>
                    <p id="hall-lounge-players"></p>
                </td>
                <td id="lounge" class="room">
                    <p id="lounge-players"></p>
                </td>
                <td class="empty"></td>
            </tr>
            {# Row 3 #}
            <tr>
                <td id="plum-starting" class="starting"></td>
                <td class="hallway">
                    <a class="hallwaytext">Study - Library</a>
                    <p id="study-library-players"></p>
                </td>
                <td class="empty"></td>
                <td class="hallway">
                    <a class="hallwaytext">Hall - Billiard Room</a>
                    <p id="hall-billiard-players"></p>
                </td>
                <td class="empty"></td>
                <td class="hallway">
                    <a class="hallwaytext">Lounge - Dining Room</a>
                    <p id="lounge-dining-players"></p>
                </td>
                <td id="mustard-starting" class="starting"></td>
            </tr>
            {# Row 4 #}
            <tr>
                <td class="empty"></td>
                <td id="library" class="room">
                    <p id="library-players"></p>
                </td>
                <td class="hallway">
                    <a class="hallwaytext">Library - Billiard Room</a>
                    <p id="library-billiard-players"></p>
                </td>
                <td id="billiard" class="room">
                    <p id="billiard-players"></p>
                </td>
                <td class="hallway">
                    <a class="hallwaytext">Billiard Room - Dining Room</a>
                    <p id="billiard-dining-players"></p>
                </td>
                <td id="dining" class="room">
                    <p id="dining-players"></p>
                </td>
                <td class="empty"></td>
            </tr>
            {# Row 5 #}
            <tr>
                <td id="peacock-starting" class="starting"></td>
                <td class="hallway">
                    <a class="hallwaytext">Library - Conservatory</a>
                    <p id="library-conservatory-players"></p>
                </td>
                <td class="empty"></td>
                <td class="hallway">
                    <a class="hallwaytext">Billiard Room - Ballroom</a>
                    <p id="billiard-ballroom-players"></p>
                </td>
                <td class="empty"></td>
                <td class="hallway">
                    <a class="hallwaytext">Dining Room - Kitchen</a>
                    <p id="dining-kitchen-players"></p>
                </td>
                <td class="empty"></td>
            </tr>
            {# Row 6 #}
            <tr>
                <td class="empty"></td>
                <td id="conservatory" class="room">
                    <p id="conservatory-players"></p>
                </td>
                <td class="hallway">
                    <a class="hallwaytext">Conservatory - Ballroom</a>
                    <p id="conservatory-ballroom-players"></p>
                </td>
                <td id="ballroom" class="room">
                    <p id="ballroom-players"></p>
                </td>
                <td class="hallway">
                    <a class="hallwaytext">Ballroom - Kitchen</a>
                    <p id="ballroom-kitchen-players"></p>
                </td>
                <td id="kitchen" class="room">
                    <p id="kitchen-players"></p>
                </td>
                <td class="empty"></td>
            </tr>
            {# Row 7 #}
            <tr>
                <td class="empty"></td>
                <td class="empty"></td>
                <td id="green-starting" class="starting"></td>
                <td class="empty"></td>
                <td id="white-starting" class="starting"></td>
                <td class="empty"></td>
                <td class="empty"></td>
            </tr>
            </tbody>
        </table>
        </div>

        <!-- so many divs -->
        <div>
            <div>
                <div style="margin-top: 10px;">
                    <div>
                        <select class="custom-select" id="rooms" style="width:50%"></select>
                    </div>
                    <div>
                         <button id="move-room">Move to Room</button>
                    </div>
                </div>
                <div style="margin-top: 10px;">
                    <div>
                        <select class="custom-select" id="hallways" style="width:50%"></select>
                    </div>
                    <div>
                        <button id="move-hallway">Move to Hallway</button>
                    </div>
                </div>
            </div>
            <div style="float:right; margin-top: -110px; margin-right:0px;">
                <button id="end-turn" class="btn btn-secondary">End Turn</button>
                <a id="end-game" class="btn btn-success" href="{% url 'endgame' %}">End Game</a>
            </div>
        </div>
    </div>



    {# Right Column #}
    <div class="right right-all">

    {# Scratchpad #}
        <div id="scratchpad" class="scratchpad noBorder" style="font-family:optima;">
            <table style="text-align:center;">
                <tr style="height:40px;">
                    <th colspan="3" style="font-family:chalkduster; font-size:120%;">Scratchpad</th>
                </tr>
                <tr>
                    <th colspan="3">Suspects</th>
                </tr>
                <tr>
                    <td>Mr. Green</td>
                    <td>Prof. Plum</td>
                    <td>Coln. Mustard</td>
                </tr>
                <tr>
                    <td>Mrs. Peacock</td>
                    <td>Miss Scarlet</td>
                    <td>Mrs. White</td>
                </tr>
                <tr>
                    <th colspan="3">Weapons</th>
                </tr>
                <tr>
                    <td>Candlestick</td>
                    <td>Knife</td>
                    <td>Lead Pipe</td>
                </tr>
                <tr>
                    <td>Revolver</td>
                    <td>Rope</td>
                    <td>Wrench</td>
                </tr>
                <tr>
                    <th colspan="3">Rooms</th>
                </tr>
                <tr>
                    <td>Study</td>
                    <td>Hall</td>
                    <td>Lounge</td>
                </tr>
                <tr>
                    <td>Library</td>
                    <td>Billiard Room</td>
                    <td>Dining Room</td>
                </tr>
                <tr>
                    <td>Conservatory</td>
                    <td>Ballroom</td>
                    <td>Kitchen</td>
                </tr>
            </table>
        </div>

        <br />
        <br />

        <div class="options" style="margin-left:0px">

        {# Make Suggestion dropdowns/button #}
            <div style="float:left">
                <p class="title">Make Suggestion</p>

                <a>Character:</a>
                <select class="custom-select" id="character-sugg">
                    <option value="Miss Scarlet">Miss Scarlet</option>
                    <option value="Mrs. Peacock">Mrs. Peacock</option>
                    <option value="Professor Plum">Professor Plum</option>
                    <option value="Mr. Green">Mr. Green</option>
                    <option value="Colonel Mustard">Colonel Mustard</option>
                    <option value="Mrs. White">Mrs. White</option>
                </select>

                <br/>

                <a>Weapon:</a>
                <select class="custom-select" id="weapon-sugg">
                    <option value="Rope">Rope</option>
                    <option value="Lead Pipe">Lead Pipe</option>
                    <option value="Knife">Knife</option>
                    <option value="Wrench">Wrench</option>
                    <option value="Candlestick">Candlestick</option>
                    <option value="Revolver">Revolver</option>
                </select>
                <br/> <br/>
                <button id="suggest" class="btn btn-warning">Suggest!</button>

                <div id="disprove-div" class="options-inner" style="margin-top: 25px;">
                    <p class="title"">Disprove Suggestion</p>
                    <select id="cards-disprove" class="custom-select" style="width: 160px;"></select>
                    <button id="disprove-sugg" class="btn btn-primary btn-sm" style="width: 160px; margin-top:5px;">Disprove Suggestion</button>
                    <button id="cannot-disprove" class="btn btn-primary btn-sm" style="width: 160px; margin-top:5px;">Forfeit Disprove</button>
                </div>

            </div>
        {# Make Accusation dropdowns/button #}
            <div style="float:right">
            <p class="title">Make Accusation</p>

            <a>Character:</a>
            <select class="custom-select" id="character-acc">
                <option value="Miss Scarlet">Miss Scarlet</option>
                <option value="Mrs. Peacock">Mrs. Peacock</option>
                <option value="Professor Plum">Professor Plum</option>
                <option value="Mr. Green">Mr. Green</option>
                <option value="Colonel Mustard">Colonel Mustard</option>
                <option value="Mrs. White">Mrs. White</option>
            </select>

            <br/>

            <a>Weapon:</a>
            <select class="custom-select" id="weapon-acc">
                <option value="Rope">Rope</option>
                <option value="Lead Pipe">Lead Pipe</option>
                <option value="Knife">Knife</option>
                <option value="Wrench">Wrench</option>
                <option value="Candlestick">Candlestick</option>
                <option value="Revolver">Revolver</option>
            </select>

            <br/>

            <a>Room:</a>
            <select class="custom-select" id="room-acc">
                <option value="Study">Study</option>
                <option value="Hall">Hall</option>
                <option value="Lounge">Lounge</option>
                <option value="Library">Library</option>
                <option value="Billiard Room">Billiard Room</option>
                <option value="Dining Room">Dining Room</option>
                <option value="Conservatory">Conservatory</option>
                <option value="Ballroom">Ballroom</option>
                <option value="Kitchen">Kitchen</option>
            </select>
            <br/> <br/>
            <button id="accuse" class="btn btn-danger">Accuse!</button>
            </div>
        </div>
    </div>
</div>


  <script>
    $(document).ready( function() {
      var currentPlayerInit = false;
      var disproveInit = false;
      var startingLocations = {
        "Miss Scarlet": "scarlet-starting",
        "Mrs. Peacock": "peacock-starting",
        "Professor Plum": "plum-starting",
        "Mr. Green": "green-starting",
        "Colonel Mustard": "mustard-starting",
        "Mrs. White": "white-starting"
      };
      var characterToPiece = {
        "Miss Scarlet": "scarlet-piece",
        "Mrs. Peacock": "peacock-piece",
        "Professor Plum": "plum-piece",
        "Mr. Green": "green-piece",
        "Colonel Mustard": "mustard-piece",
        "Mrs. White": "white-piece"
      };
      var startingIds = ["scarlet-starting", "peacock-starting", "plum-starting", "green-starting", "mustard-starting", "white-starting"];
      var suggestPlayer = null;
      var suggestion = []; 
      var playerCards = [];

      $.get("{% url 'playercards' %}", {csrfmiddlewaretoken : "{{ csrf_token }}"})
          .done(function(data) {
            for (var i = 0; i < data.cardList.length; i++) {
              $("#cards").append('<li class="list-group-item" style="width:50%; height:30%;">' + data.cardList[i] + '</li>')
            }
            playerCards = data.cardList;
          })

      getPlayers();
      getGameState();

      function getGameState() {
        $.get("{% url 'game' %}", {}, function(data) {
          data = JSON.parse(data);
          updatePage(data);
        });
        setTimeout(getGameState, 2000);
      }

      function getPlayers() {
        $.get("{% url 'game-players' %}", {}, function(data) {
          var playerList = "";
          data.players.forEach(function(item) {
            playerList += '<li style="font-family:optima">' + item + '</li>';
          });
          $("#player-list").html(playerList);
        });
      }

      function updatePage(data){
        //console.log(data);
        if (data.specialMessage.length > 0 && data.currentPlayer == "{{ user.get_username }}") {
            showMessage(data.specialMessage, data.currentPlayer);
            //showMessage(data.notification, "all", true, data.currentPlayer);
          }
        else {
            showMessage(data.notification, "all");
        }
        if (data.status == "won") {
          $("#end-game").show();
          $("#end-turn").attr("disabled", true);
          $("#rooms").attr("disabled", true);
          $("#move-room").attr("disabled", true);
          $("#hallways").attr("disabled", true);
          $("#move-hallway").attr("disabled", true);
          $("#character-sugg").attr("disabled", true);
          $("#weapon-sugg").attr("disabled", true);
          $("#suggest").attr("disabled", true);
          $("#character-acc").attr("disabled", true);
          $("#weapon-acc").attr("disabled", true);
          $("#room-acc").attr("disabled", true);
          $("#accuse").attr("disabled", true);
        }
        else {
          if (data.disprovePlayer != "{{ user.get_username }}") {
            $('#disprove-div').hide()
          }
          else {
            var cards = "";
            playerCards.forEach(function(item) {
              if (data.currentSuggestion.indexOf(item) != -1) {
                cards += "<option>" + item + "</option>";
              }
            });
            if (!disproveInit) {
              disproveInit = true;
              $("#cards-disprove").html(cards);
              if (cards.length == 0) {
                $("#disprove-sugg").attr("disabled", true);
                $("#cannot-disprove").attr("disabled", false);
              }
              else {
                $("#disprove-sugg").attr("disabled", false);
                $("#cannot-disprove").attr("disabled", true);
              }
              $('#disprove-div').show();
            }
          }
          $("#end-game").hide();
          $("#current-player").html(data.currentPlayer + " (" + data.currentCharacter + ")");
          updateBoard(data.board, data.currentCharacter);
          console.log(data.disprovePlayer.length)
          if (data.currentPlayer == "{{ user.get_username }}") {
            $("#end-turn").attr("disabled", false);
            if (!currentPlayerInit) {
              updateMovement(data.validMoves)
              currentPlayerInit = true;
            }
          } else {
            $("#end-turn").attr("disabled", true);
            updateMovement(data.validMoves)
            currentPlayerInit = false;
          }
          if (data.validActions.indexOf("Make Suggestion") != -1) {
            $("#character-sugg").attr("disabled", false);
            $("#weapon-sugg").attr("disabled", false);
            $("#suggest").attr("disabled", false);
            $("#end-turn").attr("disabled", true)
          }
          else {
            $("#character-sugg").attr("disabled", true);
            $("#weapon-sugg").attr("disabled", true);
            $("#suggest").attr("disabled", true);
          }

          if (data.validActions.indexOf("Make Accusation") != -1) {
            $("#character-acc").attr("disabled", false);
            $("#weapon-acc").attr("disabled", false);
            $("#room-acc").attr("disabled", false);
            $("#accuse").attr("disabled", false);
          }
          else {
            $("#character-acc").attr("disabled", true);
            $("#weapon-acc").attr("disabled", true);
            $("#room-acc").attr("disabled", true);
            $("#accuse").attr("disabled", true);
          }

          if (data.validMoves.hallways.length > 0) {
             $("#end-turn").attr("disabled", true);
          }
          if (data.validMoves.rooms.length > 0) {
            $("#end-turn").attr("disabled", true);
          }

          if (data.disprovePlayer.length > 0) {
            console.log("hello world")
            $("#end-turn").attr("disabled", true);
            $("#character-acc").attr("disabled", true);
            $("#weapon-acc").attr("disabled", true);
            $("#room-acc").attr("disabled", true);
            $("#accuse").attr("disabled", true);
          }
        }
      }

      function updateMovement(validMoves) {
        var roomList = "";
        validMoves.rooms.forEach(function(item) {
          roomList += "<option>" + item + "</option>";
        });
        if (roomList.length == 0) {
          $("#rooms").attr("disabled", true);
          $("#move-room").attr("disabled", true);
        } else {
          $("#rooms").attr("disabled", false);
          $("#move-room").attr("disabled", false);
        }
        $("#rooms").html(roomList);
        var hallwayList = "";
        validMoves.hallways.forEach(function(item) {
          hallwayList += "<option>" + item + "</option>";
        });
        if (hallwayList.length == 0) {
          $("#hallways").attr("disabled", true);
          $("#move-hallway").attr("disabled", true);
        } else {
          $("#hallways").attr("disabled", false);
          $("#move-hallway").attr("disabled", false);
        }
        $("#hallways").html(hallwayList);
      }

      function updateBoard(board, currentCharacter) {
        var hallways = board.hallways;
        var rooms = board.rooms;
        var starting = board.starting;
        for (var i = 0; i < hallways.length; i++) {
          var key = Object.keys(hallways[i])[0];
          var id = getIdForBoard(key);
          var playerList = hallways[i][key];
          var final_html = "";
          for (var j = 0; j < playerList.length; j++) {
            final_html = final_html + getImageForCharacter(playerList[j], currentCharacter);
            if (j == 2) {
              final_html = final_html + "<br/>";
            }
          }
          $("#" + id).html(final_html);
        }
        for (var i = 0; i < rooms.length; i++) {
          var key = Object.keys(rooms[i])[0];
          var id = getIdForBoard(key);
          var playerList = rooms[i][key];
          var final_html = "";
          for (var j = 0; j < playerList.length; j++) {
            final_html = final_html + getImageForCharacter(playerList[j], currentCharacter);
            if (j == 2) {
              final_html = final_html + "<br/>";
            }
          }
          $("#" + id).html(final_html);
        }
        for (var i = 0; i < startingIds.length; i++) {
          var id = startingIds[i];
          $("#" + id).empty();
        }
        for (var i = 0; i < starting.length; i++) {
          var key = starting[i];
          var id = startingLocations[key];
          $("#" + id).html(getImageForCharacter(key, currentCharacter));
        }
      }

      function getImageForCharacter(character, currentCharacter) {
        if (character == "Miss Scarlet") {
          if (currentCharacter == "Miss Scarlet") {
            return "<img src='../static/scarlet-piece.png' id='scarlet-piece' class='current-player'>";
          }
          else {
            return "<img src='../static/scarlet-piece.png' id='scarlet-piece' class='pieces'>";
          }
        }
        else if (character == "Mrs. Peacock") {
          if (currentCharacter == "Mrs. Peacock") {
            return "<img src='../static/peacock-piece.png' id='peacock-piece' class='current-player'>";
          }
          else {
            return "<img src='../static/peacock-piece.png' id='peacock-piece' class='pieces'>";
          }
        }
        else if (character == "Professor Plum") {
          if (currentCharacter == "Professor Plum") {
            return "<img src='../static/plum-piece.png' id='plum-piece' class='current-player'>";
          }
          else {
            return "<img src='../static/plum-piece.png' id='plum-piece' class='pieces'>";
          }
        }
        else if (character == "Mr. Green") {
          if (currentCharacter == "Mr. Green") {
            return "<img src='../static/green-piece.png' id='green-piece' class='current-player'>";
          }
          else {
            return "<img src='../static/green-piece.png' id='green-piece' class='pieces'>";
          }
        }
        else if (character == "Colonel Mustard") {
          if (currentCharacter == "Colonel Mustard") {
            return "<img src='../static/mustard-piece.png' id='mustard-piece' class='current-player'>";
          }
          else {
            return "<img src='../static/mustard-piece.png' id='mustard-piece' class='pieces'>";
          }
        }
        else if (character == "Mrs. White") {
          if (currentCharacter == "Mrs. White") {
            return "<img src='../static/white-piece.png' id='white-piece' class='current-player'>";
          }
          else {
            return "<img src='../static/white-piece.png' id='white-piece' class='pieces'>";
          }
        }
      }

      function getIdForBoard(name) {
        if (name == "Study") {
          return "study-players";
        } else if (name == "Study - Hall") {
            return "study-hall-players";
        } else if (name == "Hall") {
            return "hall-players";
        } else if (name == "Hall - Lounge") {
            return "hall-lounge-players";
        } else if (name == "Lounge") {
            return "lounge-players";
        } else if (name == "Study - Library") {
            return "study-library-players";
        } else if (name == "Hall - Billiard Room") {
            return "hall-billiard-players";
        } else if (name == "Lounge - Dining Room") {
            return "lounge-dining-players";
        } else if (name == "Library") {
            return "library-players";
        } else if (name == "Library - Billiard Room") {
            return "library-billiard-players";
        } else if (name == "Billiard Room") {
            return "billiard-players";
        } else if (name == "Billiard Room - Dining Room") {
            return "billiard-dining-players";
        } else if (name == "Dining Room") {
            return "dining-players";
        } else if (name == "Library - Conservatory") {
            return "library-conservatory-players";
        } else if (name == "Billiard Room - Ballroom") {
            return "billiard-ballroom-players";
        } else if (name == "Dining Room - Kitchen") {
            return "dining-kitchen-players";
        } else if (name == "Conservatory") {
            return "conservatory-players";
        } else if (name == "Conservatory - Ballroom") {
            return "conservatory-ballroom-players";
        } else if (name == "Ballroom") {
            return "ballroom-players";
        } else if (name == "Ballroom - Kitchen") {
            return "ballroom-kitchen-players";
        } else if (name == "Kitchen") {
            return "kitchen-players";
        }
      }

      function showMessage(message, audience) {
        var existing = $("#notification").html();
        existing = existing.split("<br>");
        existing = existing.filter(function(e){return e != ""});
        var newText = "";
        if (existing[0] == message) {
          newText = $("#notification").html();
        }
        else {
          if (audience == "all") {
            if (existing.length < 5) {
              newText = message + "<br/>" + $("#notification").html();
            }
            else {
              existing.pop();
              existing.unshift(message);
              newText = existing.join("<br/>");
            }
          }
          else if (audience === "{{ user.username }}") {
            if (existing.length < 5) {
              newText = message + "<br/>" + $("#notification").html();
            }
            else {
              existing.pop();
              existing.unshift(message);
              newText = existing.join("<br/>");
            }
          }
          else {
            newText = $("#notification").html();
          }
        }
        $("#notification").html(newText);
      }

      $("#end-turn").click(function() {
        $.post("{% url 'endturn' %}", {csrfmiddlewaretoken : "{{ csrf_token }}"})
          .done(function(data) {
            data = JSON.parse(data);
            updatePage(data);
          })
      });

      $("#accuse").click(function() {
        var weapon = $('#weapon-acc :selected').text();
        var room = $('#room-acc :selected').text();
        var character = $('#character-acc :selected').text();
        $.post("{% url 'accusation' %}", {csrfmiddlewaretoken : "{{ csrf_token }}",
          weapon: weapon, room: room, character: character})
          .done(function(data) {
            data = JSON.parse(data);
            updatePage(data);
            updateMovement(data.validMoves)
          })
      });

      $("#suggest").click(function() {
        var weapon = $('#weapon-sugg :selected').text();
        var character = $('#character-sugg :selected').text();
        suggestPlayer = "{{ user.username }}";
        $.post("{% url 'suggestion' %}", {csrfmiddlewaretoken : "{{ csrf_token }}",
          weapon: weapon, character: character})
          .done(function(data) {
            data = JSON.parse(data);
            updatePage(data);
            updateMovement(data.validMoves)
            suggestion = data.suggestion;
          })
      });

      $("#disprove-sugg").click(function() {
        var card = $('#cards-disprove :selected').text();
        $.post("{% url 'disprove' %}", {csrfmiddlewaretoken : "{{ csrf_token }}", card: card, forfeit: false})
          .done(function(data) {
            data = JSON.parse(data);
            updatePage(data);
            updateMovement(data.validMoves)
            disproveInit = false;
          })
      });

      $("#cannot-disprove").click(function() {
        $.post("{% url 'disprove' %}", {csrfmiddlewaretoken : "{{ csrf_token }}", card: "", forfeit: true})
          .done(function(data) {
            data = JSON.parse(data);
            updatePage(data);
            updateMovement(data.validMoves)
            disproveInit = false;
          })
      });

      $("#move-room").click(function() {
        var room = $('#rooms :selected').text();
        $.post("{% url 'moveroom' %}", {csrfmiddlewaretoken : "{{ csrf_token }}", room: room})
          .done(function(data) {
            data = JSON.parse(data);
            updatePage(data);
            updateMovement(data.validMoves);
          })
      });

      $("#move-hallway").click(function() {
        var hallway = $('#hallways :selected').text();
        $.post("{% url 'movehall' %}", {csrfmiddlewaretoken : "{{ csrf_token }}", hallway: hallway})
          .done(function(data) {
            data = JSON.parse(data);
            updatePage(data);
            updateMovement(data.validMoves);
          })
      });

  });

    $(function () {
        var $curParent, Content;
        $(".scratchpad").delegate("td", "click", function () {
            $(this).toggleClass('strikethrough');
        });
    });

  </script>
{% else %}
  <script>
    location.replace("{% url 'index' %}")
  </script>
{% endif %}
{% endblock %}
