<!-- cluelesstemplates/index.html -->
{% extends 'base.html' %}

{% block title %}Clue-Less{% endblock %}

{% block content %}
{% if user.is_authenticated %}
  <h1>Hi {{ user.username }}!</h1>
  <p><a href="{% url 'logout' %}">logout</a></p>
  <button id="send-message">Send Message</button>
  <button id="clear">Clear</button>
  <p id="game-state"></p>

  <script type="text/javascript">
    var isActive = true;

    $(document).ready( function() {
      pollServer();

      $("#send-message").click(function() {
        $.post("{% url 'game' %}", {csrfmiddlewaretoken : "{{ csrf_token }}", name: "{{ user.username }}"})
          .done(function(data) {
            updateBoard(data.messages);
          })
      });

      $("#clear").click(function() {
        $.post("{% url 'clear_state' %}", {csrfmiddlewaretoken : "{{ csrf_token }}"})
          .done(function(data) {
            updateBoard(data.messages);
          })
      });
    });

    function pollServer() {
      $.get("{% url 'game' %}", function(data) {
        updateBoard(data.messages);
      });
      setTimeout(pollServer, 2000);
    }

    function updateBoard(items) {
      var gameString = "";
      items.forEach(function(item) {
        gameString += item += "<br/>";
      });
      $("#game-state").html(gameString);
    }
  </script>
{% else %}
  <p>You are not logged in</p>
  <a href="{% url 'login' %}">Log in</a>
  <p>Don't have an account?</p>
  <a href="{% url 'signup' %}">Sign up</a>
{% endif %}
{% endblock %}
